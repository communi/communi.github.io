<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>Communi: QML bot example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://communi.github.io"><img alt="Logo" src="communi.png"/></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Communi
   &#160;<span id="projectnumber">3.7.0</span>
   </div>
   <div id="projectbrief">A cross-platform IRC framework written with Qt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">QML bot example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The QML bot example is a simplified version of the <a class="el" href="bot.html">bot example</a>, written in QML. See the <a class="el" href="qml.html">QML compatibility</a> article for more QML specific details.</p>
<div class="image">
<img src="qmlbot.png" alt=""/>
<div class="caption">
The QML bot example in action</div></div>
<p>The following snippet illustrates how <a class="el" href="classIrcConnection.html" title="Provides means to establish a connection to an IRC server.">IrcConnection</a> is prepared and opened, and how a command is queued to automatically join a channel when connected.</p>
<div class="fragment"><div class="line">        connection: IrcConnection {</div>
<div class="line">            id: connection</div>
<div class="line"> </div>
<div class="line">            host: &quot;irc.libera.chat&quot;</div>
<div class="line">            userName: &quot;communi&quot;</div>
<div class="line">            nickName: &quot;QmlBot&quot; + Math.round(Math.random() * 9999)</div>
<div class="line">            realName: qsTr(&quot;Communi %1 QML bot example&quot;).arg(irc.version())</div>
<div class="line"> </div>
<div class="line">            Component.onCompleted: {</div>
<div class="line">                // queue a command to automatically join a channel when connected</div>
<div class="line">                sendCommand(command.createJoin(channel))</div>
<div class="line">                open()</div>
<div class="line">            }</div>
</div><!-- fragment --><p> The example utilizes <a class="el" href="classIrcCommandParser.html" title="Parses commands from user input.">IrcCommandParser</a> for parsing commands from messages received from other clients. In order to take the parser in use, the supported commands must be teached, as illustrated below. Some of the commands are context sensitive, and the parser must be therefore kept aware of the list of channels the bot is on. This is easily achieved by binding the IrcCommandParser::channels property to the value of the IrcBufferModel::channels property. Furthermore, like a typical IRC bot, the commands are triggered using a slightly different syntax in queries and channels.</p>
<div class="fragment"><div class="line">    property IrcCommandParser parser: IrcCommandParser {</div>
<div class="line">        id: parser</div>
<div class="line"> </div>
<div class="line">        // keep the parser aware of the context</div>
<div class="line">        channels: model.channels</div>
<div class="line"> </div>
<div class="line">        // - on channel, respond to: &quot;!&lt;command&gt; &lt;params&gt;&quot; and &quot;bot: &lt;command&gt; &lt;params&gt;&quot;</div>
<div class="line">        // - in query, respond to: &quot;!&lt;command&gt; &lt;params&gt;&quot; and &quot;&lt;command&gt; &lt;params&gt;&quot;</div>
<div class="line">        triggers: connection.network.isChannel(target) ? [&quot;!&quot;, connection.nickName + &quot;:&quot;] : [&quot;!&quot;, &quot;&quot;]</div>
<div class="line"> </div>
<div class="line">        Component.onCompleted: {</div>
<div class="line">            // teach the bot some commands</div>
<div class="line">            parser.addCommand(IrcCommand.Nick, &quot;NICK &lt;nick&gt;&quot;);</div>
<div class="line">            parser.addCommand(IrcCommand.Join, &quot;JOIN &lt;#channel&gt; (&lt;key&gt;)&quot;);</div>
<div class="line">            parser.addCommand(IrcCommand.Part, &quot;PART (&lt;#channel&gt;) (&lt;message...&gt;)&quot;);</div>
<div class="line">            parser.addCommand(IrcCommand.Quit, &quot;QUIT (&lt;message...&gt;)&quot;);</div>
<div class="line">            parser.addCommand(IrcCommand.Message, &quot;SAY [target] &lt;message...&gt;&quot;);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p> The bot listens to incoming messages via <a class="el" href="classIrcConnection.html#a621c4c16a74639e9f358bd2ef0f5bccd">IrcConnection::messageReceived()</a>. The current target is chosen based on whether the incoming message is a channel or a private message. Each message content is parsed for commands that were taught earlier.</p>
<div class="fragment"><div class="line">            onMessageReceived: {</div>
<div class="line">                if (message.type === IrcMessage.Private) {</div>
<div class="line">                    // - in private, reply to the message sender</div>
<div class="line">                    // - on channel, reply to the target channel</div>
<div class="line">                    parser.target = message.private ? message.nick : message.target</div>
<div class="line"> </div>
<div class="line">                    var command = parser.parse(message.content)</div>
<div class="line">                    if (command) {</div>
<div class="line">                        // send the command to the IRC server</div>
<div class="line">                        sendCommand(command)</div>
<div class="line">                        if (command.type === IrcCommand.Quit) {</div>
<div class="line">                            // close the connection &amp; quit the app when a !quit command was received</div>
<div class="line">                            close()</div>
<div class="line">                            Qt.quit()</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
</div><!-- fragment --><p> Files: </p><ul>
<li><a class="el" href="qmlbot_2main_8cpp.html">examples/qmlbot/main.cpp</a> </li>
<li><a class="el" href="qmlbot_2qml_2main_8qml.html">examples/qmlbot/qml/main.qml</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 18 2021 23:21:00 for Communi by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
